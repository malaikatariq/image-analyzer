<!DOCTYPE html>
<html>
<head>
  <title>Image Analyzer</title>
</head>
<body>
<h1>Upload Image for Analysis</h1>
<input type="file" id="fileInput" accept="image/*">
<button onclick="analyze()">Analyze</button>
<br><br>
<canvas id="canvas"></canvas>
<div id="result"></div>

<script>
async function analyze() {
    const file = document.getElementById("fileInput").files[0];
    if (!file) return alert("Select an image");

    const reader = new FileReader();
    reader.onload = async () => {
        const base64 = reader.result.split(",")[1]; // remove prefix

        // Call Azure Function
        const response = await fetch("https://<YOUR-FUNCTION-URL>", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ imageBase64: base64 })
        });

        const data = await response.json();

        // Draw image and faces
        const img = new Image();
        img.src = reader.result;
        img.onload = () => {
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            document.getElementById("result").innerHTML = "";
            data.faces.forEach((face, i) => {
                const r = face.faceRectangle;
                ctx.strokeStyle = "red";
                ctx.lineWidth = 2;
                ctx.strokeRect(r.left, r.top, r.width, r.height);
                ctx.fillStyle = "red";
                ctx.fillText(`${face.gender}, ${face.age}`, r.left, r.top - 5);

                document.getElementById("result").innerHTML += 
                    `Face ${i+1}: ${face.gender}, Age ${face.age}<br>`;
            });
        };
    };
    reader.readAsDataURL(file);
}
</script>
</body>
</html>
